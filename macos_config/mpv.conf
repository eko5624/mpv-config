vo                      = gpu-next    # intel芯片建议libmpv,性能更好。silicon芯片建议gpu-next
hwdec                   = videotoolbox
#icc-force-contrast     = 1000
vd-lavc-dr              = yes         # <默认yes|no> 是否直接解码到显存，个别低端英特尔处理器需禁用此功能以大幅提速解码
vd-lavc-software-fallback = 60        # 最大限度采用硬解
opengl-pbo              = yes         # may help with 4K videos
#scale                  = spline36    # 放大算法。spline36：高质量算法，gpu-hq的默认设置
#dscale                 = mitchell    # 缩小算法，mitchell质量最好，如不设定则采用scale设置
#video-sync             = display-resample
#interpolation          = yes         # 仅开启video-sync=display-resample时生效
#tscale                 = oversample  # 仅开启interpolation时生效
include                 = "~~/img-opts.conf"
include                 = "~~/img-profiles.conf"
log-file                = "~/Downloads/output.log"
input-builtin-bindings  = no

#Fast profile
scale                   = bilinear
cscale                  = bilinear
dscale                  = bilinear
scale-antiring          = 0.0
correct-downscaling     = no
linear-downscaling      = no
sigmoid-upscaling       = no
target-colorspace-hint  = no
hdr-compute-peak        = no
hdr-peak-percentile     = 100
hdr-contrast-recovery   = 0.0
dither                  = no
#libplacebo-opts=preset = fast

#Window                                 
border                  = no         #无边框界面（去除WINDOWS的窗口装饰）
osc                     = no
idle                    = yes
title                   = "${filename}" # 标题显示为当前播放文件名
hidpi-window-scale      = yes          # [推荐设置为no] 默认yes。MPV支持HIDPI没有实际意义，因为本身不是GUI程序
force-window            = immediate   # Do not wait with showing the video window until it has loaded.
reset-on-next-file      = vf,af,audio-delay,sub-pos,sub-scale,sub-delay,sub-speed,sub-visibility,speed,video-aspect,video-zoom,video-rotate,video-pan-x,video-pan-y,panscan
geometry                = 50%:50%     #force starting with centered window
autofit-larger          = 100%x100%
save-position-on-quit   = no
cursor-autohide         = 1000        #1秒后自动隐藏鼠标
keep-open               = yes         #播放完成不关闭窗口
input-media-keys        = no          #enable/disable OSX media keys
force-seekable          = yes
ytdl                    = yes
ytdl-raw-options-append = cookies-from-browser=edge
#macos-app-activation-policy = accessory

#Playlist
autocreate-playlist     = same        # <默认no|filter|same> 打开单个本地文件时，是否自动填充播放列表，默认禁用
                                      # 值 filter 为依据 --directory-filter-types --video-exts 等选项填充当前目录下的其它文件至播放列表
                                      # 值 same 表现为，在 filter 的基础上，仅填充同类文件（例如打开的为视频，则仅填充视频类文件）
directory-filter-types  = video,audio,image
                                      # <video,audio,image> 打开目录或使用 --autocreate-playlist 自动填充播放列表时，限制填充的文件类型，示例即默认值
video-exts              = 3g2,3gp,avi,flv,m2ts,m4v,mj2,mkv,mov,mp4,mpeg,mpg,ogv,rmvb,ts,webm,wmv,y4m
                                      # 打开目录或使用 --autocreate-playlist 自动填充播放列表时，限制填充文件类型对应的扩展名白名单
                                      # 示例即默认值。下方二项的功能同理
image-exts              = avif,bmp,gif,j2k,jp2,jpeg,jpg,jxl,png,psd,svg,tga,tif,tiff,webp
audio-exts              = aac,ac3,aiff,ape,au,dts,eac3,flac,m4a,mka,mp3,oga,ogg,ogm,opus,thd,wav,wav,wma,wv

#Audio
ad-lavc-downmix         = yes         # 混音至双通道
audio-channels          = stereo      # 混音至双通道
audio-normalize-downmix = yes         # 两者要同时起用
audio-file-auto         = fuzzy                             
alang                   = en,eng,zh,chi
volume                  = 80
volume-max              = 200

#Subs
slang                   = chi,zh-CN,jpn,sc,chs
sub-auto                = fuzzy 
sub-font-size           = 43
sub-shadow-offset       = 0
sub-color               = '#F0FFFFFF'
#sub-font               = 'Microsoft Yahei'           # 对ass字幕无效
sub-file-paths          = ass:srt:sub:subs:subtitles    # search for external subs in the listed subdirectories

#Screenshot
screenshot-format       = png         # <默认 jpg|(同前)jpeg|png|webp|jxl|avif>
screenshot-jpeg-quality = 100         # <0-100> JPEG的质量，默认 90
screenshot-jpeg-source-chroma = no    # 用与源视频相同的色度半采样写入JPEG，默认 yes
screenshot-png-compression    = 5     # <0-9> PNG压缩等级，过高的等级影响性能，默认 7
screenshot-png-filter   = 0           # <0-5> PNG的压缩过滤器。默认 5 即可 实现最佳压缩率
screenshot-webp-lossless= yes         # 无损WEBP，默认 no
screenshot-webp-quality = 100         # <0-100> [当 --screenshot-webp-lossless=no 时生效] 有损WEBP的质量，默认 75
screenshot-webp-compression   = 3     # <0-6> WEBP压缩等级，使用有损WEBP时进一步降低图片质量，默认 4
screenshot-jxl-distance = 0           # <0-15> JXL的视觉模型距离，0为质量无损，0.1为视觉无损，默认 1 相当于JPEG的90质量
screenshot-jxl-effort   = 5           # <1-9> JXL压缩等级，过高的等级影响性能，默认 3
screenshot-tag-colorspace     = yes   # 使用适当的色彩空间标记屏幕截图（并非所有格式受支持）默认no
screenshot-high-bit-depth     = yes   # 主要影响PNG，尽可能使用和视频输出时相同的位深，默认yes
screenshot-sw           = no          # 是否对屏幕截图使用软件渲染，默认：no。软件渲染器可能缺少某些功能，例如 HDR 渲染
screenshot-avif-pixfmt  = yuv420p10le # 启用支持HDR模式的avif格式截图
screenshot-template     = "~~desktop/%F-%wH-%wM-%wS"

#OSD
osd-on-seek             = msg-bar
osd-bar-h               = 2
osd-bar-border-size     = 0.2
osd-border-size         = 0
osd-font-size           = 40
osd-fractions           = yes
osd-playing-msg         = "${filename}"
osd-font                = "Microsoft Yahei"
osd-font-size           = 24          # 更改 OSD 字体大小（全局，影响多个功能显示的文本）（默认值：38）
osd-duration            = 2000
osd-playing-msg-duration= 3000

#Auto_profiles # 条件触发配置，根据给定条件激发特定参数。如有其他补充的通用参数请不要写在下方！！！
[ontop]
profile-desc            = 基于播放状态的自动置顶
profile-cond            = not pause
profile-restore         = copy
ontop                   = yes 

[hdr2sdr-stm-conf]
profile-desc            = "HDR转SDR(静态色调映射)"
blend-subtitles         = video       # 问题状态（静态映射不受影响） https://github.com/mpv-player/mpv/issues/6368
target-peak             = 100         # <10-10000> 值越低，画面整体越亮。默认auto即203（不要用作通用参数，因为会影响sdr片源的正常输出亮度）
hdr-compute-peak        = no          # 当yes时提供了基于场景的动态色调映射默认auto（完整支持该特性需要显卡opengl版本≥4.3）
tone-mapping            = hable       # <auto默认|clip|mobius|reinhard|hable|bt.2390|gamma|linear> 色调映射算法
tone-mapping-param      = default     # 上项的小参。default根据算法的使用不同初始值，对部分算法无效 clip=1.0; mobius=0.3; reinhard=0.5; gamma=1.8; linear=1.0
tone-mapping-max-boost  = 1.0         # <1.0-10.0> 过曝指数，默认1.0
gamut-mapping-mode      = clip        # <auto默认|clip|warn|desaturate> 完成色调映射后的色域裁剪方式

[hdr2sdr-dtm-conf]
profile-desc            = "HDR转SDR(动态色调映射)"
blend-subtitles         = no
hdr-compute-peak        = yes
hdr-peak-decay-rate     = 150         # [须 --hdr-compute-peak=yes ] <0.0-1000.0> 亮度峰值检测算法的衰减率，默认100.0
hdr-scene-threshold-low = 4           # [须 --hdr-compute-peak=yes ] <0.0-100.0> 场景变化亮度的下限阈值，默认1.0
hdr-scene-threshold-high= 16          # [须 --hdr-compute-peak=yes ] <0.0-100.0> 场景变化亮度的上限阈值，默认3.0
tone-mapping            = bt.2390
tone-mapping-param      = 2.0
tone-mapping-max-boost  = 1.5         # 增大此值可显示暗处隐藏的细节，过高会使暗处看起来不自然地明亮。可以尝试 1.0,1.33 下的表现
gamut-mapping-mode      = clip        # 完成色调映射后的色域裁剪方式

[img-conf]
scale                   = lanczos     # 可以用 nearest 算法使像素被精确复制
cscale                  = spline36    # 图片大多无色度半采样（大多数时候为无效参数）
dscale                  = mitchell    # 图片的原生分辨率通常符合描述信息，因此缩小时不建议使用偏锐利的算法
sigmoid-upscaling       = yes
correct-downscaling     = yes         # 同理 --dscale ，削弱缩小时产生的锯齿感
background              = tiles       # 绘制透明背景层
background-color        = "#FFFFFF"        
image-display-duration  = inf         # 图片呈现时间改为无限，默认 1 （单位为秒）
loop-file               = inf         # 防止动图播完暂停
loop-playlist           = inf
video-sync              = audio

##⇘⇘屏蔽音频与字幕类的无用项
ao                      = null
aid                     = no
mute                    = yes
audio-file-auto         = no
sid                     = no
sub-auto                = no

##⇘⇘杂项处理
prefetch-playlist       = yes         # load the next image before viewing it
osd-level               = 0           # 不显示OSD信息
term-status-msg         =             # 移除无用的 00:00:00 / 00:00:00 行显示
window-dragging         = no          # 与预设的自由拖拽图片的快捷键功能冲突
auto-window-resize      = yes         # 启用窗口自动调节大小
keepaspect-window       = no          # 窗口比例锁定为视频比例
script-opts-append      = osc-visibility=never  # 禁用OSC

[Images-HDR]
profile-cond=(p.video_params.gamma == "pq" or p.video_params.gamma == "hlg") and p['current-tracks/video/image'] and not p['current-tracks/video/albumart']
profile-restore         = copy
profile                 = img-conf,hdr2sdr-dtm-conf

[Images-SDR]
profile-cond=(p.video_params.gamma ~= "pq" and p.video_params.gamma ~= "hlg") and p['current-tracks/video/image'] and not p['current-tracks/video/albumart']
profile-restore         = copy
profile                 = img-conf
icc-profile             = "/Library/ColorSync/Profiles/Displays/Color LCD-6C7AB30C-6FF6-E4F1-5087-98730D5F6453.icc" # 图片模式需要指定校色文件才能显示正确的颜色
#icc-profile-auto       = yes

[extension.gif]
profile-restore         = copy
profile                 = img-conf

[Music]
profile-cond            = not vid and not vo_configured or p["current-tracks/video/albumart"]
profile-restore         = copy
background-color        = "#181818"
force-window            = yes
geometry                = 1280x720-0-0
script-opts-append=osc-visibility=always

[FPS60->FPS30]
profile-cond            = p["container-fps"]>30 and p["container-fps"]<61
profile-restore         = copy
vf=fps=30

[HDR->SDR静态版]
profile-desc            = HDR转SDR（静态色调映射）
#profile-cond           = p["video-params/sig-peak"]>1 and not p['current-tracks/video/image']
profile-restore         = copy
profile                 = hdr2sdr-stm-conf

[HDR->EDR]
profile-desc            = 启用EDR
profile-cond            = get("video-out-params/max-luma") > 203 and p.current_vo == "libmpv"
profile-restore         = copy
cocoa-cb-output-csp     = bt.2100-pq
target-trc              = pq
target-prim             = bt.2020

[HDR->SDR动态版]
profile-cond            = p["video-params/sig-peak"]>1 and not p['current-tracks/video/image']
profile-restore         = copy
profile                 = hdr2sdr-dtm-conf

[HDR直通]
#profile-cond           = get("video-out-params/max-luma") > 203 and not p['current-tracks/video/image']
profile-restore         = copy
target-colorspace-hint  = yes
target-prim             = bt.2020
target-trc              = pq
target-peak             = 500 # 可设为显示器实际峰值亮度
blend-subtitles         = no
